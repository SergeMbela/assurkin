"use strict";(self.webpackChunkassurkin=self.webpackChunkassurkin||[]).push([[63],{2063:(T,g,a)=>{a.r(g),a.d(g,{RsComponent:()=>F});var b=a(467),e=a(4438),i=a(177),v=a(9981),m=a(5312),y=a(6580);let x=(()=>{class s{supabase;constructor(){this.supabase=(0,y.UU)(m.c.supabaseUrl,m.c.supabaseKey)}getLocations(){var t=this;return(0,b.A)(function*(){const{data:o,error:n}=yield t.supabase.from("personnes").select("id, nom, latitude, longitude, adresse");return n?(console.error("Erreur Supabase:",n),[]):o})()}static \u0275fac=function(o){return new(o||s)};static \u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const k=["mapContainer"];function C(s,h){if(1&s){const t=e.RV6();e.j41(0,"button",15),e.bIt("click",function(){const n=e.eBV(t).$implicit,p=e.XpG();return e.Njj(p.selectTab(n))}),e.EFF(1),e.k0s()}if(2&s){const t=h.$implicit,o=e.XpG();e.Y8G("ngClass",o.activeTab===t?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),e.R7$(),e.SpI(" ",o.tabLabels[t]," ")}}function w(s,h){1&s&&(e.j41(0,"div",16)(1,"div",17),e.qSk(),e.j41(2,"svg",18),e.nrm(3,"circle",19)(4,"path",20),e.k0s(),e.joV(),e.j41(5,"p",21),e.EFF(6,"Chargement de la carte..."),e.k0s()()())}const E=["facebook","instagram","linkedin","maps"];let F=(()=>{class s{placesService;platformId;MAPBOX_TOKEN=m.c.mapboxAccessToken;mapContainer;map;tabs=E;tabLabels={facebook:"Facebook",instagram:"Instagram",linkedin:"LinkedIn",maps:"Carte"};activeTab="facebook";isLoadingMap=!1;isDestroyed=!1;constructor(t,o){this.placesService=t,this.platformId=o}ngAfterViewInit(){"maps"===this.activeTab&&(0,i.UE)(this.platformId)&&this.initMap()}selectTab(t){this.activeTab!==t&&(this.activeTab=t,"maps"===t&&!this.map&&(0,i.UE)(this.platformId)&&this.initMap())}initMap(){var t=this;return(0,b.A)(function*(){if(!t.MAPBOX_TOKEN)return void console.error("Mapbox access token is not set. Please add it to your environment file.");if(t.isLoadingMap||t.map)return;t.isLoadingMap=!0;const o=yield a.e(247).then(a.t.bind(a,1247,23));t.isDestroyed||(t.map=new o.Map({accessToken:t.MAPBOX_TOKEN,container:t.mapContainer.nativeElement,style:"mapbox://styles/mapbox/streets-v12",center:[4.3517,50.8503],zoom:12,attributionControl:!1}),t.map.addControl(new o.NavigationControl,"top-right"),t.map.on("load",()=>{t.placesService.getLocations().then(n=>{if(!t.map)return;const p=n.map(r=>({type:"Feature",properties:{...r},geometry:{type:"Point",coordinates:[r.longitude,r.latitude]}}));t.map.addSource("places",{type:"geojson",data:{type:"FeatureCollection",features:p},cluster:!0,clusterMaxZoom:14,clusterRadius:50}),t.map.addLayer({id:"clusters",type:"circle",source:"places",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#51bbd6",10,"#f1f075",100,"#f28cb1"],"circle-radius":["step",["get","point_count"],20,10,30,100,40]}}),t.map.addLayer({id:"cluster-count",type:"symbol",source:"places",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}}),t.map.addLayer({id:"unclustered-point",type:"circle",source:"places",filter:["!",["has","point_count"]],paint:{"circle-color":"#FF0000","circle-radius":6,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}),t.map.on("click","clusters",r=>{const c=t.map?.queryRenderedFeatures(r.point,{layers:["clusters"]});if(!c?.length)return;const l=c[0].properties?.cluster_id;(t.map?.getSource("places")).getClusterExpansionZoom(l,(f,d)=>{f||null==d||t.map?.easeTo({center:c[0].geometry.coordinates,zoom:d})})}),t.map.on("click","unclustered-point",r=>{if(!r.features?.length||!t.map)return;const c=r.features[0].geometry.coordinates.slice(),l=r.features[0].properties,d=`\n            <div class="popup-content">\n              <h3 class="font-bold text-lg mb-1">${l?.nom}</h3>\n              ${l?.adresse?`<p class="text-gray-600 text-sm">${l?.adresse}</p>`:""}\n            </div>`;new o.Popup({closeButton:!1,className:"assurkin-popup",offset:{top:[0,12],bottom:[0,-12],left:[12,0],right:[-12,0]}}).setLngLat(c).setHTML(d).addTo(t.map)}),t.map.on("mouseenter","clusters",()=>t.map&&(t.map.getCanvas().style.cursor="pointer")),t.map.on("mouseleave","clusters",()=>t.map&&(t.map.getCanvas().style.cursor="")),t.map.on("mouseenter","unclustered-point",()=>t.map&&(t.map.getCanvas().style.cursor="pointer")),t.map.on("mouseleave","unclustered-point",()=>t.map&&(t.map.getCanvas().style.cursor="")),t.isLoadingMap=!1}).catch(n=>{console.error("Erreur lors du chargement des points d'int\xe9r\xeat :",n),t.isLoadingMap=!1})}))})()}ngOnDestroy(){this.isDestroyed=!0,this.map?.remove(),this.map=void 0}static \u0275fac=function(o){return new(o||s)(e.rXU(x),e.rXU(e.Agw))};static \u0275cmp=e.VBU({type:s,selectors:[["app-rs"]],viewQuery:function(o,n){if(1&o&&e.GBs(k,5),2&o){let p;e.mGM(p=e.lsd())&&(n.mapContainer=p.first)}},standalone:!0,features:[e.aNF],decls:28,vars:6,consts:[["mapContainer",""],[1,"container","mx-auto","p-4","sm:p-6","lg:p-8"],["routerLink","/management",1,"inline-flex","items-center","text-indigo-600","hover:text-indigo-800","mb-4","group"],["fill","none","stroke","currentColor","viewBox","0 0 24 24","xmlns","http://www.w3.org/2000/svg",1,"w-5","h-5","mr-2","text-indigo-600","group-hover:text-indigo-800"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"text-2xl","sm:text-3xl","font-bold","text-gray-800","mb-6"],[1,"border-b","border-gray-200","mb-6"],["aria-label","Tabs",1,"-mb-px","flex","space-x-6"],["class","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm",3,"ngClass","click",4,"ngFor","ngForOf"],[3,"hidden"],[1,"bg-white","shadow-md","rounded-lg","p-6","text-center"],[1,"text-gray-600"],[1,"relative"],[1,"h-[500px]","w-full","rounded-lg","shadow-md"],["class","absolute inset-0 z-10 flex items-center justify-center bg-white bg-opacity-75 rounded-lg",4,"ngIf"],[1,"whitespace-nowrap","py-4","px-1","border-b-2","font-medium","text-sm",3,"click","ngClass"],[1,"absolute","inset-0","z-10","flex","items-center","justify-center","bg-white","bg-opacity-75","rounded-lg"],[1,"text-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-8","w-8","text-blue-500","mx-auto"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"mt-2","text-gray-600"]],template:function(o,n){1&o&&(e.j41(0,"div",1)(1,"a",2),e.qSk(),e.j41(2,"svg",3),e.nrm(3,"path",4),e.k0s(),e.EFF(4," Retour \xe0 la gestion "),e.k0s(),e.joV(),e.j41(5,"h1",5),e.EFF(6,"R\xe9seaux Sociaux & Donn\xe9es"),e.k0s(),e.j41(7,"div",6)(8,"nav",7),e.DNE(9,C,2,2,"button",8),e.k0s()(),e.j41(10,"div")(11,"div",9)(12,"div",10)(13,"p",11),e.EFF(14,"Contenu pour Facebook \xe0 impl\xe9menter ici."),e.k0s()()(),e.j41(15,"div",9)(16,"div",10)(17,"p",11),e.EFF(18,"Contenu pour Instagram \xe0 impl\xe9menter ici."),e.k0s()()(),e.j41(19,"div",9)(20,"div",10)(21,"p",11),e.EFF(22,"Contenu pour LinkedIn \xe0 impl\xe9menter ici."),e.k0s()()(),e.j41(23,"div",9)(24,"div",12),e.nrm(25,"div",13,0),e.DNE(27,w,7,0,"div",14),e.k0s()()()()),2&o&&(e.R7$(9),e.Y8G("ngForOf",n.tabs),e.R7$(2),e.Y8G("hidden","facebook"!==n.activeTab),e.R7$(4),e.Y8G("hidden","instagram"!==n.activeTab),e.R7$(4),e.Y8G("hidden","linkedin"!==n.activeTab),e.R7$(4),e.Y8G("hidden","maps"!==n.activeTab),e.R7$(4),e.Y8G("ngIf",n.isLoadingMap))},dependencies:[i.MD,i.YU,i.Sq,i.bT,v.Wk],styles:[".map-wrapper{position:relative;height:500px;width:100%}.map-container{position:absolute;top:0;bottom:0;width:100%}::ng-deep .assurkin-popup .mapboxgl-popup-content{background-color:#fff;border-radius:8px;box-shadow:0 4px 12px #00000026;padding:0;font-family:inherit;max-width:280px}::ng-deep .assurkin-popup .popup-content{padding:1rem}\n"],encapsulation:2})}return s})()}}]);