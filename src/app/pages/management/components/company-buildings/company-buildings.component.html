<div class="buildings-container">
  <div class="flex justify-between items-center mb-6">
    <h3 class="text-2xl font-bold text-gray-800">Bâtiments</h3>
    <button (click)="initAdd()" *ngIf="!showForm" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm">Add Building</button>
  </div>

  <div *ngIf="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4">
    {{ error }}
  </div>

  <div *ngIf="isLoading" class="text-center py-4 text-gray-500">
    Chargement en cours, veuillez patienter ...
  </div>

  <!-- Form Section -->
  <div *ngIf="showForm" class="building-form bg-white shadow-md rounded-lg p-6 mb-6">
    <h4 class="text-xl font-semibold mb-4 text-gray-800">{{ isEditing ? 'Edit' : 'Add' }} Bâtiments</h4>
    
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-1">Addresse *</label>
      <input [(ngModel)]="currentBuilding.address" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Address">
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Code postal</label>
        <input [(ngModel)]="currentBuilding.postal_code" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Postal Code">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
        <input [(ngModel)]="currentBuilding.city" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="City">
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Pays</label>
        <input [(ngModel)]="currentBuilding.country" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Country">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
        <select [(ngModel)]="currentBuilding.building_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option value="">Select Type</option>
          <option value="Bureau">Bureau</option>
          <option value="Entrepôt">Entrepôt</option>
          <option value="Résidentiel">Résidentiel</option>
          <option value="Usine">Usine</option>
        </select>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Surface  (m²)</label>
        <input type="number" [(ngModel)]="currentBuilding.surface_area" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Surface Area">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Année de construction</label>
        <input type="number" [(ngModel)]="currentBuilding.construction_year" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Year">
      </div>
    </div>

    <div class="flex justify-end mt-6">
      <button (click)="saveBuilding()" [disabled]="isLoading" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:opacity-50 mr-2">Enregistrer</button>
      <button (click)="cancelForm()" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500">Annuler</button>
    </div>
  </div>

  <!-- List Section -->
  <div *ngIf="!showForm && !isLoading" class="buildings-list">
    <!-- Search Bar -->
    <div class="mb-6" *ngIf="buildings.length > 0">
      <input type="text" [(ngModel)]="searchTerm" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm transition-all" placeholder="Search by address, city, or type...">
    </div>

    <div *ngIf="paginatedBuildings.length === 0" class="bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4 mb-4">
      No buildings found.
    </div>

    <div *ngFor="let building of paginatedBuildings" class="bg-white shadow rounded-lg p-4 mb-3 border border-gray-200">
      <div class="flex justify-between items-center">
        <div>
          <h5 class="text-lg font-medium text-gray-900">{{ building.address }}</h5>
          <p class="text-sm text-gray-500">{{ building.postal_code }} {{ building.city }}, {{ building.country }}</p>
          <small class="text-xs text-gray-400">{{ building.building_type }} <span *ngIf="building.surface_area">- {{ building.surface_area }} m²</span></small>
        </div>
        <div class="flex gap-2">
          <button (click)="initEdit(building)" class="px-3 py-1 text-sm text-blue-600 border border-blue-600 rounded hover:bg-blue-50 transition-colors">Edit</button>
          <button (click)="deleteBuilding(building.id)" class="px-3 py-1 text-sm text-red-600 border border-red-600 rounded hover:bg-red-50 transition-colors">Delete</button>
        </div>
      </div>
    </div>

    <!-- Pagination Controls -->
    <div class="flex justify-between items-center mt-6" *ngIf="totalPages > 1">
      <button class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" (click)="prevPage()" [disabled]="currentPage === 1">Previous</button>
      <span class="text-sm text-gray-600">Page {{ currentPage }} of {{ totalPages }}</span>
      <button class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
    </div>
  </div>
</div>
