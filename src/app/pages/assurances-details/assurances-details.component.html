<div class="container mx-auto p-4">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Détails du Devis</h1>
    <a [routerLink]="['/management']" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-300">
      Retour à la liste
    </a>
  </div>

  <app-state-container [state]="(devisState$ | async) || { loading: true }">
    <ng-template #dataTemplate let-state>
      <div class="bg-white shadow-lg rounded-lg p-6">
        <div *ngIf="state.data as devis" class="grid grid-cols-1 md:grid-cols-2 gap-6">
          
          <!-- Informations sur le Devis -->
          <div class="p-4 border rounded-lg">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Informations Générales</h2>
            <p><strong>ID du Devis :</strong> {{ devis.details?.id }}</p>
            <p><strong>Compagnie :</strong> {{ devis.compagnie_nom }}</p>
            <p><strong>Date de création :</strong> {{ devis.details?.created_at | date:'dd/MM/yyyy HH:mm' }}</p>
            <p><strong>Date d'effet :</strong> {{ devis.details?.date_effet | date:'dd/MM/yyyy' }}</p>
            <p><strong>Statut :</strong> <span class="font-medium" [ngClass]="{
              'text-green-600': devis.details?.statut === 'Accepté',
              'text-yellow-600': devis.details?.statut === 'En cours de traitement',
              'text-red-600': devis.details?.statut === 'Refusé'
            }">{{ devis.details?.statut }}</span></p>
          </div>

          <!-- Informations sur le Preneur (Client) -->
          <div class="p-4 border rounded-lg">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Preneur d'assurance</h2>
            <p><strong>Nom :</strong> {{ devis.preneur?.prenom }} {{ devis.preneur?.nom }}</p>
            <p><strong>Email :</strong> {{ devis.preneur?.email }}</p>
            <p><strong>Téléphone :</strong> {{ devis.preneur?.telephone }}</p>
            <p><strong>Adresse :</strong> {{ devis.preneur?.adresse }}, {{ devis.preneur?.code_postal }} {{ devis.preneur?.ville }}</p>
          </div>

          <!-- Informations sur le Véhicule -->
          <div class="p-4 border rounded-lg">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Véhicule</h2>
            <p><strong>Type :</strong> {{ devis.vehicule?.type }}</p>
            <p><strong>Marque :</strong> {{ devis.vehicule?.marque }}</p>
            <p><strong>Modèle :</strong> {{ devis.vehicule?.modele }}</p>
            <p><strong>Année :</strong> {{ devis.vehicule?.annee }}</p>
            <p><strong>Plaque :</strong> {{ devis.vehicule?.plaque }}</p>
            <p><strong>Valeur :</strong> {{ devis.vehicule?.valeur | currency:'EUR':'symbol' }}</p>
          </div>

          <!-- Informations sur la Couverture -->
          <div class="p-4 border rounded-lg">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Couverture d'assurance</h2>
            <p><strong>Type :</strong> {{ devis.type }}</p>
            <p><strong>RC de base :</strong> {{ devis.details?.garantie_base_rc ? 'Oui' : 'Non' }}</p>
            <p><strong>Assistance :</strong> {{ devis.details?.garantie_assistance ? 'Oui' : 'Non' }}</p>
            <p><strong>Protection du conducteur :</strong> {{ devis.details?.garantie_conducteur ? 'Oui' : 'Non' }}</p>
            <p><strong>Omnium :</strong> {{ devis.details?.garantie_omnium_niveau || 'Aucune' }}</p>
          </div>

        </div>
        <div *ngIf="!state.data" class="text-center text-gray-500 mt-8">
          Aucun détail trouvé pour ce devis.
        </div>
      </div>
    </ng-template>
  </app-state-container>
</div>